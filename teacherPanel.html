<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Sistema de Controle de Chaves</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
        
    <!-- Custom CSS -->
    <link rel="stylesheet" href="teacherPanel.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>
    

</head>
<body class="bg-light d-flex flex-column">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid align-items-center">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="public/senailogo.png" alt="Logo SENAI" class="me-2" style="height: 40px;">
            </a>
            <div class="navbar-center">
                <img src="public/chave-unscreen.gif" alt="Chave animada" class="me-2 navbar-key-gif">
                <h1 class="h2 mb-0 fw-bold text-white text-center">Sistema de Controle de Chaves</h1>
            </div>
            <button onclick="showAdmLogin()" id="btnAdm" class="btn d-flex align-items-center ms-auto">
                <span class="navbar-text text-light">
                    <i class="bi bi-person-circle me-1"></i>
                    Administrador
                </span>
            </button>
        </div>
    </nav>

    <div class="main-content align-self-center py-5">
        <!-- Cabeçalho -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="text-3xl font-bold text-foreground flex items-center gap-3">
                    <i class="bi bi-building me-2 text-primary"></i>
                    Dashboard do Professor
                </h1>
            </div>            
            <div class="d-flex align-items-center gap-3">
                <div class="d-flex align-items-center">
                    <label for="teacherDateSelector" class="form-label me-2 mb-0 text-muted">Data:</label>
                    <input type="date" id="teacherDateSelector" class="form-control form-control-sm" style="width: auto;">
                </div>
                <span class="text-sm text-muted-foreground">
                    Mudança automática às 12:00
                </span>
            </div>
        </div>

        <!-- Abas de Turno -->
        <div class="row-actions d-flex items-center justify-between mb-3">
            <div class="tabs" id="shiftTabs"></div>
            <div class="toolbar">
                <button class="btn btn-outline" onclick="openThirdPartyForm()">
                    <i data-lucide="plus"></i> Registrar Terceiro
                </button>
            </div>                
        </div>

        <!-- Conteúdo por Turno -->
        <div class="card shadow-sm border-0 p-4" id="shiftContent"></div>
    </div>

    <!-- Modal: Login Professor -->
    <div class="modal" id="loginModal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
        <div class="modal-content">
            <div class="modal-header login-header">
                <div class="modal-title d-flex align-items-start" id="loginTitle">
                    <i class="bi bi-key-fill"></i>
                    <h2>Digite o seu FATS</h2>
                </div>                
                
                <button class="btn-close-popup" onclick="closeLogin()" aria-label="Fechar">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <label class="text-sm font-medium">FATS do professor *
                <div class="input-item">
                    <i class="bi bi-card-list"></i>
                    <input 
                        type="text" 
                        id="loginFast" 
                        placeholder="Insira seu FATS para retirar a chave"
                        autocomplete="off"
                    >
                </div>
            </label>
            
            <p id="msg-erro" class="msg-erro font-size-14px "></p>

            <div class="modal-actions">
                <button id="cancel-btn" class="btn" onclick="closeLogin()">
                    Cancelar
                </button>
                <button id="btn-retirar-chave" class="btn" onclick="confirmLogin()">
                    Retirar a chave
                </button>
            </div>
        </div>
    </div> <!-- Fim do Modal Login Professor -->

    <!-- Modal: Registrar Terceiro -->
    <div class="modal" id="thirdPartyModal" role="dialog" aria-modal="true" aria-labelledby="tpTitle">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="tpTitle">
                    <i class="bi bi-person-fill-add"></i>
                    <h2>Registro de Terceiros</h2>
                </div>

                <button class="btn-close-popup" onclick="closeThirdPartyForm()" aria-label="Fechar">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <label class="text-sm font-medium">Nome Completo *
                <div class="input-item">
                    <i class="bi bi-person"></i>
                    <input 
                        type="text" 
                        id="tpFullName" 
                        placeholder="Nome completo do terceiro"
                    >
                </div>
            </label>

            <label class="text-sm font-medium">Motivo *
                <div class="input-item">
                    <i class="bi bi-file-earmark-text"></i>
                    <input 
                        type="text" 
                        id="tpPurpose"
                        placeholder="Motivo para retirar a chave"
                    >
                </div>
            </label>

            <div class="drop-down-list d-flex flex-column">
                <!-- Pergunta sobre quantas chaves -->
                <div id="key-quantity-section" class="drop-down-item visible">
                    <label class="text-sm font-medium mb-3">
                        Quantas chaves você deseja pegar?
                    </label>

                    <div class="d-flex gap-3">
                        <button type="button" id="single-btn" class="btn key-mode-btn btn-outline-primary" onclick="selectKeyMode('single')" style="position: relative;">
                            <i onclick="goBackToKeyQuantity()" class="cancel-selection invisible d-flex justify-content-center align-items-center bi bi-x"></i>
                            <i class="bi bi-key"></i> Uma chave específica
                        </button>

                        <button type="button" id="multiple-btn" class="btn key-mode-btn btn-outline-success" onclick="selectKeyMode('multiple')" style="position: relative;">
                            
                            <i onclick="goBackToKeyQuantity()" class="cancel-selection invisible d-flex justify-content-center align-items-center bi bi-x"></i>
                            
                            <img id="green-key-img" src="public/green-keys.svg" alt="Chaves" style="width: 30px;">
                            Múltiplas chaves
                        </button>
                    </div>
                </div>
                
                <!-- Seleção de bloco -->
                <div id="block-dropdown" class="drop-down-item hidden">
                    <label class="text-sm font-medium">
                        Selecione o Bloco *
                    </label>
                    
                    <div class="dropdown">
                        <div class="selected d-flex justify-content-between align-items-center">
                            <p id="valueBlock">Selecione o bloco</p>
                            <i class="arrow-icon bi bi-caret-down-fill"></i>
                        </div>
                        
                        <ul class="options"></ul>
                    </div>
                </div>
                
                <!-- Seleção de sala (apenas para modo single) -->
                <div id="room-dropdown" class="drop-down-item hidden">
                    <label class="dropdown-header">
                        Sala *
                    </label>

                    <div class="dropdown">
                        <div onclick="" id="room-drop-list" class="selected d-flex justify-content-between align-items-center">
                            <p id="valueRoom">Selecione a sala</p>
                            <i class="arrow-icon bi bi-caret-down-fill"></i>
                        </div>                     
                        
                        <ul id="room-dropdown-op" class="options"></ul>
                    </div>
                </div>

                <!-- Seleção de número da sala (apenas para modo single) -->
                <div id="room-number-dropdown" class="drop-down-item invisible">
                    <label class="text-sm font-medium">
                        Número da Sala *
                    </label>
                    
                    <div class="dropdown">
                        <div id="selected-room-number" class="selected d-flex justify-content-between align-items-center">
                            <p id="valueRoomNumber">Selecione o número da sala</p>
                            <i class="arrow-icon bi bi-caret-down-fill"></i>
                        </div>
                        
                        <ul id="room-number-op" class="options"></ul>
                    </div>
                </div>

                <!-- Seção para seleção múltipla de chaves por bloco -->
                <div id="multiple-selection-section" class="drop-down-item invisible">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <label class="text-sm font-medium">
                            Chaves Disponíveis no <span id="selected-block-name">Bloco</span>
                        </label>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllAvailableKeys()">
                                <i class="bi bi-check-all"></i> Todas Disponíveis
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearAllSelectedKeys()">
                                <i class="bi bi-x-circle"></i> Limpar
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-warning" onclick="goBackToKeyQuantity()">
                                <i class="bi bi-arrow-left"></i> Voltar
                            </button>
                        </div>
                    </div>
                    
                    <div id="available-keys-container" class="available-keys-container">
                        <!-- As chaves disponíveis serão inseridas aqui -->
                    </div>
                    
                    <div id="selected-keys-summary" class="selected-keys-summary mt-3">
                        <small class="text-muted">
                            <span id="selected-count">0</span> chave(s) selecionada(s)
                        </small>
                    </div>
                </div>
            </div>

            <!-- <button class="btn mb-3 align-self-start" style="color: #0b5ed7;">
                <i class="bi bi-plus"></i>
                Notas Adicionais
            </button> -->
<!-- 
            <label class="text-sm font-medium" >
                <textarea 
                    id="tpNotes" 
                    rows="3">
                </textarea>
            </label> -->

            <div class="modal-actions">
                <button id="cancel-btn" class="btn btn-outline" onclick="closeThirdPartyForm()">
                    Cancelar
                </button>
                <button id="btn-register" class="btn btn-outline" onclick="saveThirdParty()">
                    Registrar Terceiro
                </button>
            </div>
        </div>
    </div> <!-- Fim do Modal Registrar Terceiro -->

  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="teacherPanel.js"></script>
</body>
</html>
